# encoding: tarantool
#

exec admin "lua type(box.xml)"
exec admin "lua xml = box.xml.load(\"<?xml version='1.0' encoding='utf-8'?><User>123<List><A>1</A><A id='abc'>2</A></List></User>\")"
exec admin "lua type(xml)"
exec admin "lua tostring(xml)"
exec admin "lua xml:xpath('//User/List')"
exec admin "lua xml:xpath('//User/List'):xpath('//A')"
exec admin "lua xml:xpath('//User/List'):xpath('A')"
exec admin "lua xml:xpath('User/List')"
exec admin "lua xml:xpath(\"//User/List/A[@id='abc']\")"

exec admin "lua elm = box.xml.element('Test')"
exec admin "lua elm"
exec admin "lua elm:attribute('abc')"
exec admin "lua elm:attribute('abc', 'cde')"
exec admin "lua elm"
exec admin "lua elm:attribute('abc', 'cde1')"
exec admin "lua elm"
exec admin "lua elm:attribute('abc1', 'a&b')"
exec admin "lua elm"
exec admin "lua elm:attribute('abc1', nil)"
exec admin "lua elm"
exec admin "lua elm:attribute('abc1', nil)"
exec admin "lua elm"
exec admin "lua xml:xpath(\"//User/List/A[@id='abc']\"):parent()"
exec admin "lua xml:xpath(\"//User/List/A[@id='abc']\"):parent():parent()"
exec admin "lua xml:xpath(\"//User/List/A[@id='abc']\"):parent():parent():parent()"
exec admin "lua xml:append()"
exec admin "lua xml:xpath(\"//User/List/A[@id='abc']\"):append(elm)"
exec admin "lua xml"
exec admin "lua xml:xpath(\"//User\"):append(elm:clone())"
exec admin "lua xml"
exec admin "lua elm:remove()"
exec admin "lua xml"
exec admin "lua elm:remove()"
exec admin "lua xml:remove()"
exec admin "lua xml:xpath('//User'):text('abc')"
exec admin "lua xml"
exec admin "lua xml:xpath(\"//User/List/A[@id='abc']\"):replace(box.xml.element('Test'))"
exec admin "lua xml"

#exec admin "lua cnt = 0"
#exec admin "lua box.fiber.resume(box.fiber.create(function() box.fiber.detach() while true do xml:xpath('//User'):replace(box.xml.element('User')) cnt = cnt + 1 if cnt > 1000 then box.fiber.sleep(0) cnt = 0 end end end))"

#exec admin "lua box.fiber.sleep(100)"

