# encoding: utf-8
# 
import sys

admin("ch = box.ipc.channel()")
admin("ch:is_full()")
admin("ch:is_empty()")
admin("ch:get(.1)")
admin("ch:put()")
admin("ch:put('test')")
admin("ch:get()")
admin("ch:get('wrong timeout')")
admin("ch:get(-10)")
admin("ch:put(234)")
admin("ch:put(345, .5)")
admin("ch:is_full()")
admin("ch:is_empty()")
admin("buffer = {}")
admin("tfbr = box.fiber.create(function() box.fiber.detach() while true do table.insert(buffer, ch:get()) end end)")
admin("box.fiber.resume(tfbr)")
admin("for i = 1, 10 do print(i, ' ', ch:put(i, 0.1)) end")
admin("ch:has_readers()")
admin("ch:has_writers()")
admin("box.fiber.cancel(tfbr)")

admin("ch:has_readers()")
admin("ch:has_writers()")
admin("ch:put(box.info.pid)")
admin("ch:is_full()")
admin("ch:is_empty()")
admin("ch:get(box.info.pid) == box.info.pid")
admin("for i, v in pairs(buffer) do print(v) end")

admin("ch:is_empty()")
admin("ch:broadcast()")
admin("ch:broadcast(123)")
admin("ch:get()")

admin("ch:is_full()")
admin("ch:is_empty()")
admin("tfbr = box.fiber.create(function() box.fiber.detach() while true do local v = ch:get() table.insert(buffer, 'tfbr  - ' .. tostring(v)) end end)")
admin("box.fiber.resume(tfbr)")
admin("tfbr2 = box.fiber.create(function() box.fiber.detach() while true do local v = ch:get() table.insert(buffer, 'tfbr2 - ' .. tostring(v)) end end)")
admin("box.fiber.resume(tfbr2)")

admin("buffer = {}")

admin("for i, v in pairs(buffer) do print(v) end")
admin("ch:is_full()")
admin("ch:is_empty()")
admin("ch:put(1)")
admin("ch:put(2)")
admin("ch:put(3)")
admin("ch:put(4)")
admin("ch:put(5)")
admin("ch:broadcast('broadcast message!')")
admin("for i = 35, 45 do print(ch:put(i)) end")


admin("for i, v in pairs(buffer) do print(v) end")

