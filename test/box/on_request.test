# encoding: tarantool

exec admin "lua box.insert(0, 1, 'te-test')"
exec admin "lua box.select(0, 0, 1)"

exec admin "lua box.on_request()"
exec admin "lua box.on_request(123)"
exec admin "lua id = box.on_request(function(...) error('exception') end) "
exec admin "lua box.select(0, 0, 1)"


exec admin "lua box.remove_on_request(id)"
exec admin "lua box.remove_on_request(id)"
exec admin "lua box.select(0, 0, 1)"
exec admin "lua id = box.on_request(function(req, skip) skip() end)"
exec admin "lua box.select(0, 0, 1)"
exec admin "lua box.remove_on_request(id)"


exec admin "lua id = box.on_request(function(req, skip) return { 1, 're-test' } end)"
exec admin "lua box.select(0, 0, 1)"


exec admin "lua box.remove_on_request(id)"
exec admin "lua id = box.on_request(function(req, skip) return req.type end)"
exec admin "lua box.select(23, 12, 1)"
exec admin "lua box.delete(24, 12, 1)"
exec admin "lua box.update(25, 12, '=p', 1, 2)"
exec admin "lua box.insert(26, 2, 2, 3)"
exec admin "lua box.replace(27, 2, 2, 3)"

exec admin "lua box.remove_on_request(id)"
exec admin "lua id = box.on_request(function(req, skip) return req.space end)"
exec admin "lua box.select(23, 12, 1)"
exec admin "lua box.delete(24, 12, 1)"
exec admin "lua box.update(25, 12, '=p', 1, 2)"
exec admin "lua box.insert(26, 2, 2, 3)"
exec admin "lua box.replace(27, 2, 2, 3)"


exec admin "lua box.remove_on_request(id)"
exec admin "lua id = box.on_request(function(req, skip) return req.flags end)"
exec admin "lua box.select(23, 12, 1)"
exec admin "lua box.delete(24, 12, 1)"
exec admin "lua box.update(25, 12, '=p', 1, 2)"
exec admin "lua box.insert(26, 2, 2, 3)"
exec admin "lua box.replace(27, 2, 2, 3)"

exec admin "lua box.remove_on_request(id)"
exec admin "lua id = box.on_request(function(req, skip) return req.key end)"
exec admin "lua box.select(23, 12, 1)"
exec admin "lua box.delete(24, 12, 1)"
exec admin "lua box.update(25, 12, '=p', 1, 2)"
exec admin "lua box.insert(26, 2, 2, 3)"
exec admin "lua box.replace(27, 2, 2, 3)"

exec admin "lua box.remove_on_request(id)"
exec admin "lua id = box.on_request(function(req, skip) return unpack(req.keys) end)"
exec admin "lua box.select(23, 12, 1)"

exec admin "lua box.remove_on_request(id)"
exec admin "lua id = box.on_request(function(req, skip) return req.index end)"
exec admin "lua box.select(23, 12, 1)"

exec admin "lua box.remove_on_request(id)"
exec admin "lua id = box.on_request(function(req, skip) return req.offset end)"
exec admin "lua box.select(23, 12, 1)"

exec admin "lua box.remove_on_request(id)"
exec admin "lua id = box.on_request(function(req, skip) return req.limit end)"
exec admin "lua box.select(23, 12, 1)"

exec admin "lua box.remove_on_request(id)"
exec admin "lua id = box.on_request(function(req, skip) return req.format end)"
exec admin "lua box.update(23, 12, '=p!p#p', 11, 2, 12, 3, 34, 4)"

exec admin "lua box.remove_on_request(id)"
exec admin "lua id = box.on_request(function(req, skip) return req.opargs end)"
exec admin "lua box.update(23, 12, '=p!p#p&p:p', 11, 2, 12, 3, 34, 4, 22, 21, 27, box.pack('ppp', 223, 3332, 'abc'))"
