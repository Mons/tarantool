box.space[0]:truncate()
---
...
box.insert(0, 1, 'te-test')
---
 - 1: {'te-test'}
...
box.select(0, 0, 1)
---
 - 1: {'te-test'}
...
box.set_on_request()
---
error: 'box.set_on_request(): argument must be a function'
...
box.set_on_request(123)
---
error: 'box.set_on_request(): argument must be a function'
...
ctx = box.set_on_request(function(...) error('exception') end) 
---
...
box.select(0, 0, 1)
---
error: 'Lua error: [string "ctx = box.set_on_request(function(...) error(..."]:1: exception'
...
box.clear_on_request(ctx)
---
 - true
...
box.clear_on_request(ctx)
---
 - false
...
box.select(0, 0, 1)
---
 - 1: {'te-test'}
...
ctx = box.set_on_request(function(ctx, req, next) return next() end)
---
...
box.select(0, 0, 1)
---
error: 'Lua error: request expected as 1 argument'
...
box.clear_on_request(ctx)
---
 - true
...
ctx = box.set_on_request(function(ctx, req, next) return next(req) end)
---
...
box.select(0, 0, 1)
---
 - 1: {'te-test'}
...
SELECT * FROM t0 WHERE k0 = 1
Found 1 tuple:
[1, 'te-test']
box.replace(0, 1, 2, 3)
---
 - 1: {2, 3}
...
REPLACE INTO t0 VALUES(1, 2, 3)
Replace OK, 1 row affected
box.clear_on_request(ctx)
---
 - true
...
ctx = box.set_on_request(function(ctx, req, next) t = next(req); return 1,2,3,'Hello' end)
---
...
box.select(0, 0, 1)
---
 - 1: {}
 - 2: {}
 - 3: {}
 - 'Hello': {}
...
SELECT * FROM t0 WHERE k0 = 1
Found 4 tuples:
[1]
[2]
[3]
['Hello']
box.replace(0, 1, 2, 3)
---
 - 1: {}
 - 2: {}
 - 3: {}
 - 'Hello': {}
...
REPLACE INTO t0 VALUES(1, 2, 3)
Replace OK, 4 row affected
box.clear_on_request(ctx)
---
 - true
...
box.select(0, 0, 5)
---
...
ctx = box.set_on_request(function(ctx, req, next) next(req); return 666 end)
---
...
box.select(0, 0, 5)
---
 - 666: {}
...
SELECT * FROM t0 WHERE k0 = 5
Found 1 tuple:
[666]
box.replace(0, 5)
---
 - 666: {}
...
REPLACE INTO t0 VALUES(5)
Replace OK, 1 row affected
box.select(0, 0, 5)
---
 - 666: {}
...
SELECT * FROM t0 WHERE k0 = 5
Found 1 tuple:
[666]
box.clear_on_request(ctx)
---
 - true
...
box.select(0, 0, 5)
---
 - 5: {}
...
SELECT * FROM t0 WHERE k0 = 5
Found 1 tuple:
[5]
ctx = box.set_on_request(function(ctx, req, next)local tuple = next(req); return {'t[1] value is ', tuple[1]}end)
---
...
box.select(0, 0, 1)
---
 - 't[1] value is ': {2}
...
ctx2 = box.set_on_request(function(ctx, req, next)if req.type == 'CALL' and req.procname == 'ping' then    local res = req.args;    table.insert(res, 1, 'pong!')    return res;else    return next(req);end;end)
---
...
CALL ping('12345', '456', '7', '8', '9')
Found 1 tuple:
['pong!', '12345', '456', '7', '8', '9']
box.select(0, 0, 1)
---
 - 't[1] value is ': {2}
...
box.clear_on_request(ctx)
---
 - true
...
CALL ping()
Found 1 tuple:
['pong!']
box.select(0, 0, 1)
---
 - 1: {2, 3}
...
box.clear_on_request(ctx2)
---
 - true
...
CALL ping()
An error occurred: ER_NO_SUCH_PROC, 'Procedure 'ping' is not defined'
box.select(0, 0, 1)
---
 - 1: {2, 3}
...
ctx = box.set_on_request(function(ctx2, req, next) assert (ctx2 == ctx) end)
---
...
box.select(0, 0, 1)
---
...
box.clear_on_request(ctx)
---
 - true
...
ctx = box.set_on_request(function(ctx, req, next)ctx.count = ctx.count + 1;return ctx.msg;end)
---
...
ctx.msg = 'Check context'
---
...
ctx.count = 0
---
...
box.select(0, 0, 1)
---
 - 'Check context': {}
...
ctx.count
---
 - 1
...
box.clear_on_request(ctx)
---
 - true
...
ctx = box.set_on_request(function(ctx, req, next) return req.type end)
---
...
box.select(23, 12, 1)
---
 - 'SELECT': {}
...
box.delete(24, 12, 1)
---
 - 'DELETE': {}
...
box.update(25, 12, '=p', 1, 2)
---
 - 'UPDATE': {}
...
box.insert(26, 2, 2, 3)
---
 - 'REPLACE': {}
...
box.replace(27, 2, 2, 3)
---
 - 'REPLACE': {}
...
box.clear_on_request(ctx)
---
 - true
...
ctx = box.set_on_request(function(ctx, req, next) return req.space_id end)
---
...
box.select(23, 12, 1)
---
 - 23: {}
...
box.delete(24, 12, 1)
---
 - 24: {}
...
box.update(25, 12, '=p', 1, 2)
---
 - 25: {}
...
box.insert(26, 2, 2, 3)
---
 - 26: {}
...
box.replace(27, 2, 2, 3)
---
 - 27: {}
...
box.clear_on_request(ctx)
---
 - true
...
ctx = box.set_on_request(function(ctx, req, next) return req.flags end)
---
...
box.select(23, 12, 1)
---
 - 1: {}
...
box.delete(24, 12, 1)
---
 - 1: {}
...
box.update(25, 12, '=p', 1, 2)
---
 - 1: {}
...
box.insert(26, 2, 2, 3)
---
 - 3: {}
...
box.replace(27, 2, 2, 3)
---
 - 1: {}
...
box.clear_on_request(ctx)
---
 - true
...
ctx = box.set_on_request(function(ctx, req, next) return req.key end)
---
...
box.select(23, 12, 1)
---
 - 1: {}
...
box.delete(24, 12, 1)
---
 - 12: {1}
...
box.update(25, 12, '=p', 1, 2)
---
 - 12: {}
...
box.insert(26, 2, 2, 3)
---
 - 'nil': {}
...
box.clear_on_request(ctx)
---
 - true
...
ctx = box.set_on_request(function(ctx, req, next) return req.tuple end)
---
...
box.replace(27, 2, 2, 3)
---
 - 2: {2, 3}
...
box.clear_on_request(ctx)
---
 - true
...
ctx = box.set_on_request(function(ctx, req, next) return unpack(req.keys) end)
---
...
box.select(23, 12, 1)
---
 - 1: {}
...
box.clear_on_request(ctx)
---
 - true
...
ctx = box.set_on_request(function(ctx, req, next) return req.index_id end)
---
...
box.select(23, 12, 1)
---
 - 12: {}
...
box.clear_on_request(ctx)
---
 - true
...
ctx = box.set_on_request(function(ctx, req, next) return req.offset end)
---
...
box.select(23, 12, 1)
---
 - 0: {}
...
box.clear_on_request(ctx)
---
 - true
...
ctx = box.set_on_request(function(ctx, req, next) return req.limit end)
---
...
box.select(23, 12, 1)
---
 - 4294967295: {}
...
box.clear_on_request(ctx)
---
 - true
...
ctx = box.set_on_request(function(ctx, req, next) return req.expr end)
---
...
box.update(23, 12, '=p!p#p', 11, 2, 12, 3, 34, 4)
---
 - '\x03\x00\x00\x00\x0B\x00\x00\x00\x00\x04\x02\x00\x00\x00\x0C\x00\x00\x00\x07\x04\x03\x00\x00\x00"\x00\x00\x00\x06\x04\x04\x00\x00\x00': {}
...
box.clear_on_request(ctx)
---
 - true
...
ctx = box.set_on_request(function(ctx, req, next) return req.expr end)
---
...
box.update(23, 12, '=p!p#p&p:p', 11, 2, 12, 3, 34, 4, 22, 21, 27, box.pack('ppp', 223, 3332, 'abc'))
---
 - '\x05\x00\x00\x00\x0B\x00\x00\x00\x00\x04\x02\x00\x00\x00\x0C\x00\x00\x00\x07\x04\x03\x00\x00\x00"\x00\x00\x00\x06\x04\x04\x00\x00\x00\x16\x00\x00\x00\x02\x04\x15\x00\x00\x00\x1B\x00\x00\x00\x05\x0E\x04\xDF\x00\x00\x00\x04\x04\x0D\x00\x00\x03abc': {}
...
box.clear_on_request(ctx)
---
 - true
...
ctx = box.set_on_request(function(ctx, req, next) tuple = next(req); print(tuple); return tuple end)
---
...
box.replace(0, 1, 2, 3, 4)
---
 - 1: {2, 3, 4}
...
box.clear_on_request(ctx)
---
 - true
...
box.space[0]:truncate()
---
...
